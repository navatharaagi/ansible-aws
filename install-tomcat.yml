--- # AWS EC2 Instance Communication Shell Command Example
-  hosts: aws
   remote_user: ec2-user
   become_method: sudo
   become: yes
   gather_facts: yes
   connection: ssh
   vars_files:
     download_url: http://download.oracle.com/otn-pub/java/jdk/8u5-b13/jdk-8u5-linux-x64.tar.gz
     download_folder: /opt
     java_name: "{{download_folder}}/jdk1.8.0_05"
     java_archive: "{{download_folder}}/jdk-8u5-linux-x64.tar.gz"
     ansible_ssh_private_key_file: "./mykey.pem"
     ansible_ssh_user: ec2-user
     http_port: 8080

   tasks:
   - name: Execute a shell command for listing the directory
     shell: ls -al ~
     register: result

   - name: display the results in JSON format
     debug: var=result

   - name: add group "tomcat"
     group: name=tomcat

   - name: add user "tomcat"
     user: name=tomcat group=tomcat home=/usr/share/tomcat createhome=no

   - name: Download Java
     command: "wget -q -O {{java_archive}} --no-check-certificate --no-cookies --header 'Cookie: oraclelicense=accept-securebackup-cookie' {{download_url}} creates={{java_archive}}"

   - name: Unpack archive
     command: "tar -zxf {{java_archive}} -C {{download_folder}} creates={{java_name}}"

   - name: Fix ownership
     file: state=directory path={{java_name}} owner=tomcat group=tomcat recurse=yes

   - name: Download Tomcat
     get_url: url=http://download.nextag.com/apache/tomcat/tomcat-8/v8.5.23/bin/apache-tomcat-8.5.23.tar.gz dest=/opt/apache-tomcat-8.5.23.tar.gz

   - name: Extract archive
     command: chdir=/usr/share /bin/tar xvf /opt/apache-tomcat-8.5.23.tar.gz -C /opt/ creates=/opt/apache-tomcat-8.5.23

   - name: Symlink install directory
     file: src=/opt/apache-tomcat-8.5.23 path=/usr/share/tomcat state=link

   - name: Change ownership of Tomcat installation
     file: path=/usr/share/tomcat/ owner=tomcat group=tomcat state=directory recurse=yes

   - name: Install Tomcat init script
     get_url:
       url: https://raw.githubusercontent.com/ansible/ansible-examples/master/tomcat-standalone/roles/tomcat/files/tomcat-initscript.sh
       dest: /etc/init.d/tomcat
       mode: 0755

   - name: Start Tomcat
     service: name=tomcat state=started enabled=yes

   - name: wait for tomcat to start
     wait_for: port={{ http_port }}
